# Rea-Work
REA Systems Engineer practical task

Task: Provision a new application server and deploy the application from their Git repository.

Solution:

    In my attempt to solve the given task I have used Terraform to provision the application server in AWS. To secure the application I have used VPC along with Auto Scaling and ELB and deploy the application in it. I have used AmazonLinux ami which is publicly available in AWS.
    
    Terraform provides a flexible abstraction of resources and providers. Terraform separates the planning phase from the execution phase, by using the concept of an execution plan. Terraform generates an execution plan describing what it will do to reach the desired state, and then executes it to build the described infrastructure. As the configuration changes, Terraform is able to determine what changed and create incremental execution plans which can be applied.
    
Pre-requisites:

    1.  AWS Account and an IAM user with access to Full EC2 Console.
    
    2.  IAM user's Access & Secret keys.
    
    3.  An Amazon Linux AMI, for launching instances.
    
    4.  A computer system supporting Terraform. This document is based on Linux Machine.
        
Steps:

    1.  Installing terraform: 
           Download the terraform zip archive and unzip it in a suitable location. Once we have unzipped the terraform, update PATH environment variable pointing to terraform. Since the folder /usr/local/bin is already set to PATH environment variable, we don’t need to set it again. If you are using any other location, then specify it in the PATH environment variable either in .bash_profile or in /etc/profile
           
           $ wget https://releases.hashicorp.com/terraform/0.12.21/terraform_0.12.21_linux_amd64.zip
           $ unzip terraform_0.12.21_linux_amd64.zip 
           $ mv terraform /usr/local/bin/
           $ export PATH=$PATH:/usr/local/bin/
    Check the installation:
           $ terraform -v
           
    2.  Download/clone this repository in the path: https://github.com/basilj007/REA-Work.git to your local machine.
  
           $ git clone https://github.com/basilj007/REA-Work.git
           
    3.  Move into the downloaded/cloned repository. This directory contains 'eight' main files; 'seven' terraform file and one userdata script file:
    
		a). provider.tf: Details of resource provider, in this case it is AWS. Update IAM user's Access and Secret keys in provider.tf.
           
		b). vpc.tf: Contains the details of creating a VPC along with subnets, route tables and internet gateway.

		c). secgrp.tf: Contains creation steps for a new security group and its inbound and outbound traffic, which will allow http connections to our webservers/instances.
  	   
		d). elb.tf: Contains the details for creating an ELB (Elastic Load Balancer).

		e). launchconfig.tf: Contains all instance settings to apply to each new launched by Auto Scaling Group instance.

		f). asg.tf: Contains the details of Auto Scaling Group. The ASG configuration:
	   
		    • There will be minimum one instance to serve the traffic
		    • Auto Scaling Group will be launched with 2 instances and put each of them in separate Availability Zones in different Subnets
		    • Auto Scaling Group will get information about instance availability from the ELB
		    • Set up collection for some Cloud Watch metrics to monitor our Auto Scaling Group state
		    • Each instance launched from this Auto Scaling Group will have Name tag set to web 
		    
		g). install_nginx.sh: Contains the user_data, to install the needed packages and set up nginx.conf file for our need You can add this inside the 'launchconfig.tf' file under the 'user_data' module.

    4.  Run command ‘terraform init’: The ‘terraform init‘ command will automatically download and install any Provider binary for the providers to use within the configuration, whether the provider is AWS or Google.
       
    5.  Run command ‘terraform plan’: The ‘terraform plan’ shows what changes Terraform will apply to our infrastructure given the current state of our infrastructure as well as the current contents of our configuration. It will ask for the region in which you would like to run the you can specify the region in which the AMI is available there. I have used AMI in us-east-1.
       
    6.  And finally run ‘terraform apply’, and wait for it to complete: The ‘terraform apply’ command is used to apply the changes required to reach the desired state of the configuration, or the pre-determined set of actions generated by the ‘terraform plan’ execution plan. It will ask for the region in which you would like to run the you can specify the region in which the AMI is available there. I have used/included the AMI which is in us-east-1. So write 'us-east-1' there, or it won't work if you are using the same AMI as I have used, or you can provide your own AMI and give the corresponding region.
       
    7.  Copy ELB_IP shown in the output and paste in your browser. You will get the desired output from the deployed application. 
       
        The ELB is routing traffic to your EC2 Instances. Each time you hit the URL, it’ll pick a different Instance to handle the request. You now have a fully working cluster of web servers. The autoscaling group will spinup another instance if any of the instances goes down.
        
    8.  Delete the stack: Terraform will build the dependency graph and delete all the resources in the right order. In about a minute, AWS account should be clean again.
    
Summary:

    From this documentation you’ve set up dynamic Auto Scaling Group and Load Balancer to distribute traffic to your instances in several Availability Zones.
